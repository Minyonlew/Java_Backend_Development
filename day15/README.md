# Java Development



## Day 15  多线程技术

[TOC]

### 1. 进程与线程



#### 1.1	进程(Process)

- 进程是程序的一次动态态执行过程, 占用特定的地址空间。

- 每个进程都是独立的，由3部分组成cpu,data,code。每个进程都是独立的，保护自己的cpu时间，代码和数据，即便用同一份程序产生好几个进程，他们之间还是拥有自己这3样东西。

- **一个进程至少有一个线程**。

- **一个进程包括由操作系统分配的内存空间，包含一个或多个线程。一个线程不能独立的存在，它必须是进程的一部分。一个进程一直运行，直到所有的非守护线程都结束运行后才能结束。**

  

#### 1.2    线程（）

- 线程是进程中一个“单一的连续控制流程”。又被称为**轻量级进程**(`lightweight process`)。

- `Threads run at the same time, independently of one another` .

- **一个进程可拥有多个并行的(`concurrent`)线程**

- 一个进程中的线程共享相同的内存单元/内存地址空间-->可以访问相同的变量和对象，

  而且它们从同一堆中分配对象-->通信、数据交换、同步操作。

- 由于线程间的通信是在同一地址空间上进行的，所以不需要额外的通信机制，这就使得通信更简便而且信息传递的速度也更快。

  

#### 1.3    线程与进程的区别

|        区别 | 进程                                                         |                           **线程**                           |
| ----------: | :----------------------------------------------------------- | :----------------------------------------------------------: |
|    根本区别 | 作为资源分配的单位                                           |                       调度和执行的单位                       |
| 开       销 | 每个进程都有独立的代码和数据空间(进程上下文)，进程间的切换会有较大的开销。 | 线程可以看成时轻量级的进程，同一类线程共享代码和数据空间，每个线程有独立的运行栈和程序计数器(PC)，线程切换的开销小。 |
|    所处环境 | 在操作系统中能同时运行多个任务(程序)                         |             在同一应用程序中有多个顺序流同时执行             |
|    分配内存 | 系统在运行的时候会为每个进程分配不同的内存区域               | 除了CPU之外，不会为线程分配内存（线程所使用的资源是它所属的进程的资源），线程组只能共享资源 |
|    包含关系 | 没有线程的进程是可以被看作单线程的，如果一个进程内拥有多个线程，则执行过程不是一条线的，而是多条线（线程）共同完成的。 | 线程是进程的一部分，所以线程有的时候被称为是轻权进程或者轻量级进程。 |

> 实现并发最直接的方式是在操作系统级别使用进程。进程是运行在它自己的地址空间内的自包容的程序。多任务操作系统可以通过周期性地将CPU从一个进程切换到另一个进程，来实现同时运行多个（进程）程序，尽管这使得每个进程看起来在其执行过程中都是歇歇停停。进程被操作系统互相隔开，因此不会彼此干涉，这使得用进程编程相对容易一些。与此相反，像Java所使用的这种并发系统会共享诸如内存和I/O这样的资源，因此编程编写多线程程序最基本的困难在于，协调不同线程驱动的任务之间对这些资源的使用，以便使得这些资源不会同时被多个任务访问。
> ————————————————
> 原文链接：https://blog.csdn.net/wanliguodu/article/details/81005560





#### 1.4	多线程

> ​		Java 给多线程编程提供了内置的支持。 一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。
>
> ​		多线程是多任务的一种特别的形式，但多线程使用了更小的资源开销。
>
> ​		多线程能满足程序员编写高效率的程序来达到充分利用 CPU 的目的。



------



### 2. 实现多线程



#### 2.1	通过继承`Thread` 类实现多线程



##### 2.1.1	`Thread` 类

- 在Java中 负责线程这个功能的是 `Java.lang.Thread`这个类。可以通过创建该类的实例来创建新的进程。
- 每个线程都是通过某个特定Thread对象所对应的方法`run()`来完成其操作的，方法`run()`称为**线程体。**
- 通过调用Thead类的`start()`方法来启动一个线程。

##### 2.1.2    测试代码

```java
public class ThreadDemo01 extends Thread {
    @Override
     public void run() {
         for(int i=0;i<10;i++){
             System.out.println("第"+i+"次threadrun........");
         }
}
public static void main(String[] args) {
      //创建对象,就创建好一个线程
      ThreadDemo01 d=new ThreadDemo01();
      //d.run();
      //启动线程使用start方法
      d.start();
      for(int i=0;i<5;i++){
             System.out.println("main-->"+i);
      }
   }
}
```



#### 2.2 	通过实现`Runable` 接口实现多线程



##### 2.2.1	`Runable` 接口

- 实现 `Runnable` 接口。
- 重写 `run() `方法 。
- 创建对象，调用 `start()`方法启动进程。

##### 2.2.2 	测试代码

```java
public class MyThread implements Runnable{

	@Override
	public void run() {
		for (int i = 0; i < 50; i++) {
			System.out.println("mythread:"+i);
		}
		
	}
	public static void main(String[] args) {
		MyThread mt = new MyThread();   //代理对象
		Thread t = new Thread(mt);
		
		t.start();
		
		for (int i = 0; i < 50; i++) {
			System.out.println("main"+i);
		}
	}
}
```



##### 2.2.3 	为什么要通过`Runnable`接口来实现继承？

> -  继承 `Thread` 类方式的**缺点**： 因为在Java中只支持单继承，如果我们的类已经继承了一个父类，则其无法再继续继承 `Thread` 类。
> - 通过Runnable接口实现多线程**优点**：可以同时实现继承。实现Runnable接口方式要通用一些。
>   - 1)避免单继承
>   - 2)方便共享资源 同一份资源 多个代理访问。



##### 2.2.4	静态代理模式

> ​		设想一个场景：比如说你要结婚了，那是不是要请一个婚庆公司。因为结婚这事你需要亲力亲为，但是像布置结婚现场、活跃结婚气氛、主持结婚流程、包括善后工作，作为结婚的你当然是忙的不可开交，自然不能去做这些事情了，那么你是不是就请了一个婚庆公司，让婚庆公司帮你去做这些事，代替你去做结婚的这些事情，虽然你和婚庆公司都要去做结婚这件事情，但是其实本质上来说结婚的还是你自己。与多线程种实现Runnable接口，重写run方法非常的相似。
> ————————————————
> 原文链接：https://blog.csdn.net/qq_43411550/article/details/90901270

